<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>בדיקת Supabase</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        button {
            background: #2C5F5D;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
        }
        button:hover {
            background: #1a4a48;
        }
        #result {
            margin-top: 20px;
            padding: 15px;
            background: #f9f9f9;
            border-radius: 6px;
            white-space: pre-wrap;
            font-family: monospace;
            max-height: 400px;
            overflow-y: auto;
        }
        .success { color: green; font-weight: bold; }
        .error { color: red; font-weight: bold; }
    </style>
</head>
<body>
    <div class="container">
        <h1>🔍 בדיקת חיבור Supabase</h1>
        <p>בדיקה זו תבדוק אם החיבור ל-Supabase עובד ואם יש מוצרים במסד הנתונים.</p>

        <button onclick="testConnection()">בדוק חיבור</button>
        <button onclick="testProducts()">טען מוצרים</button>
        <button onclick="testEnvVars()">בדוק משתני סביבה</button>

        <div id="result"></div>
    </div>

    <script type="module">
        import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/+esm';

        // Environment variables - these should come from import.meta.env
        const SUPABASE_URL = import.meta.env?.VITE_SUPABASE_URL || 'https://wfxzxgabfzpishuhzejh.supabase.co';
        const SUPABASE_ANON_KEY = import.meta.env?.VITE_SUPABASE_ANON_KEY || 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6IndmeHp4Z2FiZnpwaXNodWh6ZWpoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjE5MzM0NTIsImV4cCI6MjA3NzUwOTQ1Mn0.k4kccI2ALy7HDPt7RYP8CpONZK3wJdGuqDW0zWzVCwk';

        window.supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        window.testEnvVars = function() {
            const result = document.getElementById('result');
            result.innerHTML = `
<span class="success">✅ בדיקת משתני סביבה:</span>

VITE_SUPABASE_URL: ${SUPABASE_URL}
VITE_SUPABASE_ANON_KEY: ${SUPABASE_ANON_KEY.substring(0, 20)}...

import.meta.env: ${JSON.stringify(import.meta.env, null, 2)}
            `;
        };

        window.testConnection = async function() {
            const result = document.getElementById('result');
            result.innerHTML = '<span>⏳ בודק חיבור...</span>';

            try {
                const { data, error } = await window.supabase
                    .from('products')
                    .select('count')
                    .limit(0);

                if (error) {
                    result.innerHTML = `<span class="error">❌ שגיאת חיבור:</span>\n\n${JSON.stringify(error, null, 2)}`;
                } else {
                    result.innerHTML = `<span class="success">✅ החיבור ל-Supabase עובד!</span>\n\nהטבלה 'products' קיימת ונגישה.`;
                }
            } catch (err) {
                result.innerHTML = `<span class="error">❌ שגיאה:</span>\n\n${err.message}\n\n${err.stack}`;
            }
        };

        window.testProducts = async function() {
            const result = document.getElementById('result');
            result.innerHTML = '<span>⏳ טוען מוצרים...</span>';

            try {
                const { data, error, count } = await window.supabase
                    .from('products')
                    .select('*', { count: 'exact' });

                if (error) {
                    result.innerHTML = `<span class="error">❌ שגיאה:</span>\n\n${JSON.stringify(error, null, 2)}`;
                } else {
                    result.innerHTML = `<span class="success">✅ נמצאו ${data.length} מוצרים:</span>\n\n${JSON.stringify(data, null, 2)}`;
                }
            } catch (err) {
                result.innerHTML = `<span class="error">❌ שגיאה:</span>\n\n${err.message}\n\n${err.stack}`;
            }
        };

        // Auto-run on load
        window.addEventListener('load', () => {
            testEnvVars();
        });
    </script>
</body>
</html>
